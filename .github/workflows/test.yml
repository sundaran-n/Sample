name: File Validation Workflow

on:
  workflow_dispatch:
    inputs:
      file-name:
        description: 'Enter the file to validate'
        required: true
        
      search-key:
        description: 'Enter the key'
        required: true
        

jobs:
  validate-file:
    runs-on: ubuntu-latest  

    steps:
      
      - name: Checkout repository code
        uses: actions/checkout@v2

      
      - name: Get file name and search key input
        id: inputs
        run: |
          echo "File name input: ${{ github.event.inputs['file-name'] }}"
          echo "Search key input: ${{ github.event.inputs['search-key'] }}"

      
     

      - name: Search for the file in the release directory
        id: search_file
        run: |
          release_dir="release"
          file_name="${{ github.event.inputs['file-name'] }}"
          search_key="${{ github.event.inputs['search-key'] }}"

          
          file_path=$(find $release_dir -type f -name "$file_name")

          if [ -z "$file_path" ]; then
            echo "File not found: $file_name"
            exit 1  # Exit the job if the file is not found
          else
            echo "File found at: $file_path"
            echo "::set-output name=file_path::$file_path" 
          fi

      - name: Search for the search key in the found file
        run: |
          file_path="${{ steps.search_file.outputs.file_path }}"
          search_key="${{ github.event.inputs['search-key'] }}"
          
          echo "Searching for '$search_key' in $file_path"
          
          results=""
          while IFS= read -r line; do
            if [[ "$line" == "$search_key:"* ]]; then
              results+="$line"$'\n'
            fi
          done < "$file_path"

          if [ -n "$results" ]; then
            echo "Found the following values for '$search_key':"
            echo "$results"
          else
            echo "Key '$search_key' not found in the file."
          fi
